<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Point — Dashboard</title>
  <link rel="stylesheet" href="../assets/css/dashboard.css" />
</head>

<body>
  <!-- ===== TOPO ===== -->
  <header class="topbar">
    <div class="left-controls">
      <button id="toggleSidebar" aria-label="Alternar menu lateral">☰</button>
      <h1>Smart Point</h1>
    </div>
    <div class="user-area">
      <img src="../assets/img/icons/usuario.png" alt="Perfil" class="profile-icon" />
      <button id="logoutBtn" class="logout-btn">Sair</button>
    </div>
  </header>

  <!-- ===== MENU LATERAL ===== -->
  <aside class="sidebar expanded" id="sidebar">
    <nav>
      <ul>
        <li>
          <a href="leituras.html">
            <img src="../assets/img/icons/leitura.png" alt="Leituras" />
            <span>Leituras</span>
          </a>
        </li>
        <li>
          <a href="usuarios.html">
            <img src="../assets/img/icons/usuario.png" alt="Usuários" />
            <span>Usuários</span>
          </a>
        </li>
        <li>
          <a href="relatorios.html">
            <img src="../assets/img/icons/relatorio.png" alt="Relatórios" />
            <span>Relatórios</span>
          </a>
        </li>
        <li>
          <a href="configuracoes.html">
            <img src="../assets/img/icons/cnfg.png" alt="Configurações" />
            <span>Configurações</span>
          </a>
        </li>
      </ul>
    </nav>
  </aside>

  <!-- ===== CONTEÚDO PRINCIPAL ===== -->
  <main class="content">
    <!-- ===== WIDGETS ===== -->
    <section class="widgets">
      <div class="widget" id="statusArduino">
        <img src="../assets/img/icons/arduino.png" alt="Arduino" class="widget-icon" />
        <div class="info">
          <h3>Status Arduino</h3>
          <p id="arduinoStatus">Verificando...</p>
        </div>
      </div>

      <div class="widget" id="statusRFID">
        <img src="../assets/img/icons/rfid.png" alt="RFID" class="widget-icon" />
        <div class="info">
          <h3>Status Leitor RFID</h3>
          <p id="rfidStatus">Verificando...</p>
        </div>
      </div>

      <div class="widget" id="statusPorta">
        <img src="../assets/img/icons/porta.png" alt="Porta" class="widget-icon" />
        <div class="info">
          <h3>Porta / Canal</h3>
          <p id="portaStatus">---</p>
        </div>
      </div>

      <div class="widget" id="leiturasTotais">
        <img src="../assets/img/icons/total.png" alt="Leituras Totais" class="widget-icon" />
        <div class="info">
          <h3>Leituras Totais (Hoje)</h3>
          <p id="totalLeituras">0</p>
        </div>
      </div>

      <div class="widget" id="funcAtivos">
        <img src="../assets/img/icons/funcionarios.png" alt="Funcionários Ativos" class="widget-icon" />
        <div class="info">
          <h3>Funcionários Ativos</h3>
          <p id="totalFunc">0</p>
        </div>
      </div>

      <div class="widget" id="leiturasRecusadas">
        <img src="../assets/img/icons/recusados.png" alt="Leituras Recusadas" class="widget-icon" />
        <div class="info">
          <h3>Leituras Recusadas</h3>
          <p id="leiturasRecusadasVal">0</p>
        </div>
      </div>
    </section>

    <!-- ===== PAINÉIS DE PRÉ-VISUALIZAÇÃO ===== -->
    <section class="previews">
      <div class="preview-card" id="preview-leituras">
        <div class="preview-header">
          <h3>Leituras Recentes</h3>
          <a href="leituras.html" class="btn-link">Ver todas</a>
        </div>
        <table>
          <thead>
            <tr>
              <th>Data/Hora</th>
              <th>Tag</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="ultimasLeituras">
            <tr><td colspan="3">Carregando...</td></tr>
          </tbody>
        </table>
      </div>

      <div class="preview-card" id="preview-colaboradores">
        <div class="preview-header">
          <h3>Colaboradores Ativos</h3>
          <a href="usuarios.html" class="btn-link">Ver todos</a>
        </div>
        <table>
          <thead>
            <tr>
              <th>Nome</th>
              <th>CPF</th>
              <th>Última Leitura</th>
            </tr>
          </thead>
          <tbody id="colaboradoresAtivos">
            <tr><td colspan="3">Carregando...</td></tr>
          </tbody>
        </table>
      </div>

      <div class="preview-card" id="preview-sistema">
        <div class="preview-header">
          <h3>Status do Sistema</h3>
          <a href="configuracoes.html" class="btn-link">Detalhar</a>
        </div>
        <ul class="status-list" id="statusSistema">
          <li>API: <span class="status-indicador">Verificando...</span></li>
          <li>Banco de Dados: <span class="status-indicador">Verificando...</span></li>
          <li>Dispositivo: <span class="status-indicador">Verificando...</span></li>
        </ul>
      </div>
    </section>

    <div id="loader" class="loader">Carregando dados...</div>
  </main>

  <!-- ===== CONTROLE DE LOGIN / LOGOUT / HISTÓRICO ===== -->
  <script>
    // Proteção de acesso
    const token = localStorage.getItem("token");
    if (!token) window.location.href = "index.html";

    // Bloqueio de histórico (não permite voltar após logout)
    window.history.pushState(null, null, window.location.href);
    window.onpopstate = () => {
      window.history.pushState(null, null, window.location.href);
    };

    // Logout seguro
    document.getElementById("logoutBtn").addEventListener("click", () => {
      localStorage.removeItem("token");
      window.location.replace("index.html");
    });

    // Controle da sidebar (corrigido)
    const sidebar = document.getElementById("sidebar");
    const toggleSidebar = document.getElementById("toggleSidebar");
    toggleSidebar.addEventListener("click", () => {
      sidebar.classList.toggle("collapsed");
    });
  </script>

  <script src="../assets/js/dashboard.js"></script>
</body>
</html>
